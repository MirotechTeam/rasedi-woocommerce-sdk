# Testing Guide

## 1. API Verification (Backend Logic)

Before testing inside WordPress, you can verify your API keys and the Rasedi API connection using the provided test script.

This script runs in isolation and tests:
- Ed25519 / Sodium Signing logic
- API Authentication
- Payment Creation
- Status Checking
- Payment Cancellation

**To run the test:**
```bash
php test_api.php
```

**Expected Output:**
```
Signing: ...
Creation SUCCESS. Ref: ...
Status Code: 200
Cancellation Code: 200
ALL TESTS PASSED.
```

If this fails, check your `test_api.php` keys or local PHP `sodium` extension.

---

## 2. WordPress Integration Testing

To test the plugin within WooCommerce:

### Prerequisites
- A local WordPress environment (e.g., [LocalWP](https://localwp.com/), XAMPP, or `wp-env`).
- WooCommerce plugin installed and activated.
- **Ngrok** (or similar) to test Webhooks locally.

### Steps

1.  **Install**: Upload `rasedi-woocommerce.zip` (generated by `./package.sh`) to your WordPress site.
2.  **Activate**: Activate "Rasedi Payment Gateway".
3.  **Configure**:
    - Go to **WooCommerce > Settings > Payments > Rasedi**.
    - Check **Enable Rasedi Payment**.
    - Enter your **Key ID** and **Private Key**.
    - Enable **Test Mode** (if using test keys).
4.  **Checkout**:
    - Add a product to cart and checkout.
    - Select "Rasedi Payment".
    - Click "Place Order".
    - You should be redirected to the Rasedi Payment Page.

### Webhook Testing (Crucial)

The plugin relies on Webhooks to mark the order as "Processing" or "Completed".

1.  **Expose Localhost**: If running locally, Rasedi servers cannot reach your `http://localhost`. Use ngrok:
    ```bash
    ngrok http 80
    ```
2.  **Update Site URL**: Your WordPress Site URL must match the ngrok URL for the callback to work, OR you must manually trigger the webhook using `curl` or Postman.
3.  **Manual Webhook Trigger**:
    You can simulate a webhook by sending a POST request to your site:
    `POST https://your-site.com/?wc-api=WC_Gateway_Rasedi`
    
    **Body (JSON):**
    ```json
    {
      "referenceCode": "THE_PAYMENT_REF_CODE",
      "status": "SUCCESS"
    }
    ```
4.  **Verify**: Check that the WooCommerce Order status updates from "Pending Payment" to "Processing" or "Completed".
